{% extends "base.html.twig" %}

{% block title %}
  {{site.name}}
{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    <!-- MAPBOX Stylesheet -->
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.css' rel='stylesheet' />
    <!-- Dropify -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Dropify/0.2.2/css/dropify.min.css"
          integrity="sha256-AWdeVMUYtwLH09F6ZHxNgvJI37p+te8hJuSMo44NVm0=" crossorigin="anonymous" />
    <style>
        .custom-file-label{display:none;}

         #menuMap {

             top: 0;
             background: #fff;
             padding: 10px;
         }

    </style>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <!-- Mapbox-->
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.4.1/mapbox-gl.js'></script>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiY2hhYmluZXZpYnoiLCJhIjoiY2szenk4enAxMjAxaDNscWx5MjFtYTE4ZyJ9.2mxGbAQIffpHKpGUphvYVA';
        var map = new mapboxgl.Map({
            container: 'locationMap',
            zoom: 1.5,
            style: 'mapbox://styles/mapbox/streets-v11'
        });
        /***
         * change style map
         * ****/
        var layerList = document.getElementById('menuMap');
        var inputs = layerList.getElementsByTagName('input');

        function switchLayer(layer) {
            var layerId = layer.target.id;
            map.setStyle('mapbox://styles/mapbox/' + layerId);
        }

        for (var i = 0; i < inputs.length; i++) {
            inputs[i].onclick = switchLayer;
        }
/***
 * Add animate marker
 * ****/
        var size = 100;

        var pulsingDot = {
            width: size,
            height: size,
            data: new Uint8Array(size * size * 4),

// get rendering context for the map canvas when layer is added to the map
            onAdd: function() {
                var canvas = document.createElement('canvas');
                canvas.width = this.width;
                canvas.height = this.height;
                this.context = canvas.getContext('2d');
            },

// called once before every frame where the icon will be used
            render: function() {
                var duration = 1000;
                var t = (performance.now() % duration) / duration;

                var radius = (size / 2) * 0.3;
                var outerRadius = (size / 2) * 0.7 * t + radius;
                var context = this.context;

// draw outer circle
                context.clearRect(0, 0, this.width, this.height);
                context.beginPath();
                context.arc(
                    this.width / 2,
                    this.height / 2,
                    outerRadius,
                    0,
                    Math.PI * 2
                );
                context.fillStyle = 'rgba(255, 200, 200,' + (1 - t) + ')';
                context.fill();

// draw inner circle
                context.beginPath();
                context.arc(
                    this.width / 2,
                    this.height / 2,
                    radius,
                    0,
                    Math.PI * 2
                );
                context.fillStyle = 'rgba(255, 100, 100, 1)';
                context.strokeStyle = 'white';
                context.lineWidth = 2 + 4 * (1 - t);
                context.fill();
                context.stroke();

// update this image's data with data from the canvas
                this.data = context.getImageData(
                    0,
                    0,
                    this.width,
                    this.height
                ).data;

// continuously repaint the map, resulting in the smooth animation of the dot
                map.triggerRepaint();

// return `true` to let the map know that the image was updated
                return true;
            }
        };

        map.on('load', function() {
            map.addImage('pulsing-dot', pulsingDot, { pixelRatio: 2 });

            map.addLayer({
                'id': 'points',
                'type': 'symbol',
                'source': {
                    'type': 'geojson',
                    'data': {
                        'type': 'FeatureCollection',
                        'features': [
                            {
                                'type': 'Feature',
                                'geometry': {
                                    'type': 'Point',
                                    'coordinates': [-61.551,16.265 ],
                                    'zoom': 0.3
                                }
                            }
                        ]
                    }
                },
                'layout': {
                    'icon-image': 'pulsing-dot'
                }
            });
        });

    </script>

    <!-- Dropify -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Dropify/0.2.2/js/dropify.min.js" integrity="sha256-SUaao5Q7ifr2twwET0iyXVy0OVnuFJhGVi5E/dqEiLU=" crossorigin="anonymous"></script>
    <script>
        $('.dropify').dropify({
            messages: {
                default: 'Glissez-d&eacute;posez un fichier ici ou cliquez',
                replace: 'Glissez-d&eacute;posez un fichier ou cliquez pour remplacer',
                remove:  'Supprimer',
                error:   'D&eacute;sol&eacute;, le fichier est trop volumineux'
            }
        });
    </script>
{% endblock %}


{% block content %}

    <!-- ***** Breadcumb Area Start ***** -->
    <div class="breadcumb-area height-700 bg-img bg-overlay" style="background-image: url({{ asset('img/sites-img/' ~ site.image) }})">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="breadcumb-content">
                        <div class="map-ratings-review-area d-flex">
                            <a href="#" class="d-flex align-items-center justify-content-center"><img src="{{ asset('img/core-img/map.png') }}" alt="map"></a>
                            <a href="#">8.7</a>
                            <a href="#addreviews"> Ajouter un Commentaire</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ***** Breadcumb Area End ***** -->

    <!-- ***** Single Listing Area Start ***** -->
    <section class="dorne-single-listing-area section-padding-100">
        <div class="container">
            <div class="row justify-content-center">
                <!-- Single Listing Content -->
                <div class="col-12 col-lg-8">
                    <div class="single-listing-content">

                        <div class="listing-title">
                            <h4>{{ site.name}}</h4>
                            <h6>{{ site.address}}</h6>
                        </div>

                        <div class="single-listing-nav">
                            <nav>
                                <ul id="listingNav">
                                    <li class="active"><a href="#menu">Descriptif</a></li>
                                    <li><a href="#review">Commentaires</a></li>
                                    <li><a href="#lomap">Localiser le site</a></li>
                                </ul>
                            </nav>
                        </div>

                        <div class="overview-content mt-50" id="overview">
                            <p>{{ site.content }}</p>
                            <a href="{{site.siteWeb}}" class="btn btn-block dorne-btn mt-3"> En savoir plus</a>

                            <div class="listing-menu-area mt-100" id="menu">
                                {% if site.visiteType is not empty %}
                                    <h5>Idées de visites</h5><p>
                                        {{ site.visiteType | striptags }}
                                    </p>
                                {% endif %}
                            </div>
                        </div>

                <div class="listing-reviews-area mt-100" id="review">
                            <h4>commentaires</h4>
                            {% for message in app.flashes('notice') %}
                                <div class="alert alert-success">
                                    {{ message }}
                                </div>
                            {% endfor %}
                            {% if comments is not empty %}
                                {% for comment in comments %}
                                <div class=" row single-review-area col-12">
                                    <div class="col-8">
                                        <div class="reviewer-meta d-flex align-items-center ">

                                            <img src="{{ asset('img/clients-img/avatar/' ~ comment.user.avatar) }}" alt="{{comment.user.pseudo}}">
                                            <div class="reviewer-content">
                                                <div class="review-title-ratings d-flex justify-content-between">
                                                    <h5>“{{comment.title}}”</h5>
                                                </div>
                                                <div class="">
                                                    <p>{{ comment.content | striptags }}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="reviewer-name">
                                            <h6>{{comment.user.pseudo}}</h6>
                                            <p>{{comment.createdDate| date('Y-F-d')}}</p>
                                        </div>
                                    </div> <!-- fin div col-8-->
                                    <div class="col-4 ">
                                        {% if comment.image  is defined %}
                                            <img class="rounded-circle" width="320" height="250" src="{{ asset('img/com-img/' ~ comment.image) }}" alt="{{ comment.image }}">
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="col alert alert-warning text-center">
                                    Pas de commentaire pour le moment
                                </div>
                            {% endif %}
                        </div> <!-- Review End -->

                        <div class="location-on-map mt-50" id="lomap">
                            <h4>Nous localiser</h4>
                            <div class="location-map">
                                <div id="locationMap">
                                </div>
                            </div>
                        </div>

                    </div>
                </div><!-- Location MAP End -->

                <!-- Listing Sidebar -->
                <div class="col-12 col-md-8 col-lg-4">
                    <div class="listing-sidebar">
                        <!-- Contact  -->
                        <div class="contact-form contact-form-widget mt-50">
                            <h6>Contact</h6>
                                <div class="row">
                                    <div class="col-12">
                                        {{site.name}}
                                    </div>
                                    <div class="col-12">
                                        {{site.address | striptags}}
                                    </div>
                                    <div class="col-12">
                                       {{site.tel}}
                                    </div>
                                    <div class="col-12">
                                        {{site.siteWeb}}
                                    </div>
                                </div>
                        </div> <!-- END Contact  -->

                        <!-- Opening Hours Widget -->
                        <div class="opening-hours-widget mt-50">
                            <h6>Horaires d'ouvertures</h6>
                            <div class="opening-hours">
                                <div> {{ site.openHour | striptags}}</div>
                            </div>
                        </div>

                        <!-- Courses  -->
                        <div class="contact-form contact-form-widget mt-50">
                            <h6>Parcours conseillés</h6>
                            <ul class="row">
                                {% for course in courses %}
                                <li class="col-12">
                                    <div class="add-more">
                                        <a href="{{ path('default_course', {
                                            alias : course.alias}
                                        )}}">{{course.name}}</a>
                                    </div>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <!-- Reviews -->
                    <div class="row mt-50" id="addreviews">
                        <div class="col-12 mx-auto ">
                            <h3 class="text-center mt-4">
                                Ajouter un Commentaire
                            </h3>
                            <div class=" mt-4 ">

                                {{ form(form) }}
                            </div>
                        </div>
                    </div>
                </div>   <!-- END listing sidebar  Form -->
            </div>
        </div>
    </section>
    <!-- ***** Single Listing Area End ***** -->

    
{% endblock %}
   
